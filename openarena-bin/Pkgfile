# Description: Violent, sexy, multiplayer FPS based on the Quake 3 Engine
# URL:         http://openarena.ws/
# Depends on:  curl glibc-32 libsdl libvorbis

name=openarena-bin
version=0.8.8
release=2
source="http://download.tuxfamily.org/openarena/rel/$(echo $version | tr -d .)/openarena-$version.zip
	openarena-runner.sh
	openarena.png
	openarena-server.png
	openarena.desktop
	openarena-server.desktop"

build() {
	# remove junk
	cd openarena-$version
	rm *.dll *.exe
	rm -rf __MACOSX *.app
	cd -

	mkdir -p $PKG/opt $PKG/usr/share/pixmaps  \
		$PKG/usr/share/applications $PKG/usr/bin

	mv openarena-$version $PKG/opt/openarena
	find $PKG/opt/openarena -type f -exec chmod 0644 {} \;
	find $PKG/opt/openarena -type d -exec chmod 0755 {} \;
	chmod 0755 $PKG/opt/openarena/*.i386
	chmod 0755 $PKG/opt/openarena/*.x86_64

	# prevent fullscreen on start, let the user configure the resolution
	cat > $PKG/opt/openarena/baseoa/q3config.cfg <<EOF
seta r_fullscreen "0"
EOF
	install -m 0644 -Dt $PKG/usr/share/pixmaps/ \
		$SRC/openarena.png $SRC/openarena-server.png
	install -m 0644 -Dt $PKG/usr/share/applications/ \
		$SRC/openarena.desktop $SRC/openarena-server.desktop

	install -m 0755 -Dt $PKG/opt/openarena/ \
		$SRC/openarena-runner.sh
	ln -s /opt/openarena/openarena-runner.sh $PKG/usr/bin/openarena
	ln -s /opt/openarena/openarena-runner.sh $PKG/usr/bin/openarena-server
}

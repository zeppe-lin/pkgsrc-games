# Description: SDL - Simple DirectMedia Layer, version 2
# URL:         https://www.libsdl.org/
# Depends on:  mesa
# Optional:    alsa-lib ibus jack pipewire pulseaudio wayland-protocols

name=libsdl2
version=2.32.0
release=1
#source=https://www.libsdl.org/release/SDL2-$version.tar.gz
source=$name-$version.tar.gz::https://github.com/libsdl-org/SDL/archive/refs/tags/release-$version.tar.gz

build() {
	if pkgman isinst alsa-lib >/dev/null 2>&1; then
		PKGMK_LIBSDL2="$PKGMK_LIBSDL2 -D SDL_ALSA_SHARED=ON"
	fi

	if pkgman isinst ibus >/dev/null 2>&1; then
		PKGMK_LIBSDL2="$PKGMK_LIBSDL2 -D SDL_USE_IME=ON"
	fi

	if pkgman isinst jack >/dev/null 2>&1; then
		PKGMK_LIBSDL2="$PKGMK_LIBSDL2 -D SDL_JACK_SHARED=ON"
	fi

	if pkgman isinst pipewire >/dev/null 2>&1; then
		PKGMK_LIBSDL2="$PKGMK_LIBSDL2 -D SDL_PIPEWIRE_SHARED=ON"
	fi

	if pkgman isinst pulseaudio >/dev/null 2>&1; then
		PKGMK_LIBSDL2="$PKGMK_LIBSDL2 -D SDL_PULSEAUDIO_SHARED=ON"
	fi

	if pkgman isinst wayland-protocols >/dev/null 2>&1; then
		PKGMK_LIBSDL2="$PKGMK_LIBSDL2 -D SDL_WAYLAND_SHARED=ON"
	fi

	unset CCACHE_PREFIX

	cmake -S SDL-release-$version -B build -G Ninja  \
		-D CMAKE_INSTALL_PREFIX=/usr             \
		-D CMAKE_INSTALL_LIBDIR=lib              \
		-D CMAKE_BUILD_TYPE=Release              \
		-D CMAKE_CXX_FLAGS_RELEASE="$CXXFLAGS"   \
		-D CMAKE_C_FLAGS_RELEASE="$CFLAGS"       \
		-D SDL_CLOCK_GETTIME=ON                  \
		-D SDL_RPATH=OFF                         \
		$PKGMK_LIBSDL2                           \
		-Wno-dev                                 \

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install

	# remove junk
	rm -r $PKG/usr/share/licenses
}
